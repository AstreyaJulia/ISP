года и кварталы для справки
select year as year, quarter as quarter
from sdc_certificate_work
group by year, quarter

кварталы строкой через запятую по годам
SELECT year AS year, GROUP_CONCAT(distinct quarter ORDER BY quarter ASC SEPARATOR ', ') AS quarter
FROM sdc_certificate_work
GROUP BY year


// Кол-во всех посещений за текущий день. current_date - сегодняшняя дата
select count (*)
from sdc_visits
where date_format(dtime,'%m-%d')  like  date_format(current_date,'%m-%d')

// Уникальные пользователи за тек. день
select COUNT(DISTINCT UserID)
from sdc_visits
where date_format(dtime,'%m-%d')  like  date_format(current_date,'%m-%d')



  // Кол-во посещений по дням, общее
SELECT count(id) AS count,
       DATE_ADD((CAST(dtime AS DATE)), INTERVAL 1 DAY ) AS day
FROM
    sdc_visits
GROUP BY
    DATE_ADD((CAST(dtime AS DATE)), INTERVAL 1 DAY )
ORDER BY
    day

выдаст данные в формате json:
[
  {
    "count": 21,
    "day": "2021-10-20"
  },
  {
    "count": 215,
    "day": "2021-10-22"
  },
  {
    "count": 5,
    "day": "2021-10-27"
  },
  {
    "count": 115,
    "day": "2021-10-28"
  },
  {
    "count": 1,
    "day": "2021-10-30"
  }
]

для графиков нужен формат json:
[
  {
    "count": [21, 215, 5, 115, 1],
    "day": ["2021-10-20", "2021-10-22", "2021-10-27", "2021-10-28", "2021-10-30"],
  }
]

еще лучше, если дата будет в привычном формате дд.мм.гггг
json тут: http://isp/api/visits/getVisits.php

рабочие места:

SELECT ChildUserType.id, CONCAT (ParentUserType.name, " ", ChildUserType.name) AS name
    FROM `sdc_room` AS ChildUserType
    LEFT JOIN `sdc_room` AS ParentUserType ON ChildUserType.affiliation = ParentUserType.id
    WHERE ChildUserType.icon ='desktop'


ВСЕ рабочие места с пользователями через - и без:
    SELECT ChildUserType.id, CONCAT (ParentUserType.name, " ", ChildUserType.name, COALESCE(concat(" - ", (users.fullname)), " ")) AS name
    FROM `sdc_room` AS ChildUserType
             LEFT JOIN `sdc_room` AS ParentUserType ON ChildUserType.affiliation = ParentUserType.id
             LEFT join `sdc_user_attributes` as users on ChildUserType.id = users.room
    WHERE ChildUserType.icon ='desktop'


Рабочие места с пользователями, ТОЛЬКО те, в которых есть пользователи:

SELECT ChildUserType.id, CONCAT (ParentUserType.name, " ", ChildUserType.name, " ", users.fullname) AS name
FROM `sdc_room` AS ChildUserType
         LEFT JOIN `sdc_room` AS ParentUserType ON ChildUserType.affiliation = ParentUserType.id
         LEFT join `sdc_user_attributes` as users on ChildUserType.id = users.room
WHERE ChildUserType.icon ='desktop' and users.room is not null


Рабочие места, ТОЛЬКО те, к которым не привязан пользователь

SELECT ChildUserType.id, CONCAT (ParentUserType.name, " ", ChildUserType.name) AS name
FROM `sdc_room` AS ChildUserType
         LEFT JOIN `sdc_room` AS ParentUserType ON ChildUserType.affiliation = ParentUserType.id
         LEFT join `sdc_user_attributes` as users on ChildUserType.id = users.room
WHERE ChildUserType.icon ='desktop' and users.room is null


Данные пользователя по ID
SELECT *, Users.id, CONCAT (ParentUserType.name, ' / ', ChildUserType.name) AS name
          FROM `sdc_users` AS Users
            LEFT JOIN `sdc_user_attributes` AS UserAttributes on Users.id = UserAttributes.internalKey
            LEFT JOIN `sdc_room` AS ChildUserType ON UserAttributes.room = ChildUserType.id
            LEFT JOIN `sdc_room` AS ParentUserType ON ChildUserType.affiliation = ParentUserType.id
          WHERE Users.id = ?





//Полнотекстовый поиск. В базе необходимо сделать индес типа FULLTEXT
$str = "чер супер свет сотрудник";

$str_sql = "";
foreach (explode(" ", $str) as $key => $value) {
  $str_sql .= '*'.$value.'*';
}

// Приводим $str_sql к виду "*чер**супер**свет**сотрудник*"
$sql = "SELECT
      sdc_user_attributes.fullname,
      sdc_user_attributes.comment
    FROM sdc_user_attributes
    WHERE MATCH (`fullname`,`comment`) AGAINST ('$str_sql' IN BOOLEAN MODE)";


// составим запрос из приходящих параметров
function setUpdateUser($params, $where) {
    $str = [];
    foreach ($params as $key => $value) {
      if ("`".$key."`=:".$key != str_replace(' ', '', '`id` = :id')) {
        $str[] = "`".$key."`=:".$key;
      }
    }
      $str = implode(", ", $str);
        return "UPDATE sdc_users SET $str WHERE $where";
  }

  // для образца

  select sum (reward)
  from ozon
  where date_return is null
  вознаграждение по выданным

  select count (*)
  from ozon
  where date_return is null
  всего выдано


  вознаграждение по дням
  SELECT round(sum (reward), 2) AS reward,
      DATE_ADD( date_client, INTERVAL 1 DAY ) AS day
  FROM
      ozon
  GROUP BY
      DATE_ADD( date_client, INTERVAL 1 DAY )
  ORDER BY
      day

  SELECT (YEAR(date_client) * 100) + MONTH(date_client) AS month, round(sum (reward), 2) AS reward
  FROM
      ozon
  GROUP BY
      month

  CONVERT(dtime, GETDATE())(CAST(dtime AS DATE))



  сумма заказов и средняя стоимость заказов по людям
  select LEFT(o.notpr, 8)                                                    as user,
         round(SUM(o.cost), 2)                                               as sum_cost,
         count(o.notpr)                                                      as count_otp,
         round(avg(o.cost), 2)                                               as avg_cost,
         max(o.date_client)                                                  as last_order,
         count(r.notpr)                                                      as count_return,
         round(SUM(ifnull(r.cost, 0)), 2)                                    as sum_return,
         round(((sum(ifnull(o.reward, 0))) + (SUM(ifnull(r.reward, 0)))), 2) as reward
  from ozon o
           left outer join ozon_return r on o.notpr = r.notpr
  where o.date_return is null
  GROUP BY user


  Данные по выдаче, отправлениям по месяцам
  select (YEAR(o.date_client) * 100) + MONTH(o.date_client)                  AS month,
         count(distinct (LEFT(o.notpr, 8)))                                  as users,
         round(SUM(o.cost), 2)                                               as sum_cost,
         count(o.notpr)                                                      as count_otp,
         round(avg(o.cost), 2)                                               as avg_cost,
         count(r.notpr)                                                      as count_return,
         round(SUM(ifnull(r.cost, 0)), 2)                                    as sum_return,
         round(((sum(ifnull(o.reward, 0))) + (SUM(ifnull(r.reward, 0))) + (SUM(ifnull(p.reward, 0)))), 2) as sum_reward
  from ozon o
           left outer join ozon_return r on o.notpr = r.notpr
           left outer join ozon_princip p on o.notpr = p.notpr
  where o.date_return is null
  GROUP BY month


  wb
  select (YEAR(wb.date) * 100) + MONTH(wb.date) AS month,
         round(SUM(wb.cost), 2)                 as sum_cost,
         round(SUM(wb.`return`), 2)             as sum_return,
         round(avg(wb.cost), 2)                 as avg_cost,
         round(avg(wb.`return`), 2)             as avg_return,
         round(SUM(wb.`reward`), 2)             as sum_reward,
         round(avg(wb.`reward`), 2)             as avg_reward
  from wb
  GROUP BY month



///// **** ORACLE *** /////

//// *** БСР *** ////

1-342/2021 загружен, но не опубликован
35146635,1-346/2021,2021-12-15 00:00:00,7326113,2021-12-29 16:57:38

1-333/2021 не загружен
нет

1-360/2021 опубликован
36519866,1-360/2021,2021-12-28 00:00:00,7326113,2022-01-12 17:00:33

1-346/2021 запрещен
35146635,1-346/2021,2021-12-15 00:00:00,7326113,2021-12-29 16:57:38




select *
from BSR.BSRP
where NUMDOCUM = '1-167/2021'

если в BSR.BSRP нет такого номера - дело не загружено (не прикреплен документ)

/// *** ДЕЛО *** ///
citizen - адресаты
department - сотрудники
ref_send - исходящая

вывести список пользователей
select ISN_NODE, CLASSIF_NAME
FROM ARCH_DEPARTMENT_CL
where DELETED_DATE is null AND ISN_NODE <> 0 AND ISN_HIGH_NODE <>0


/* Список загруженных, но не опубликованных дел */

select distinct b.ID_AGORA   AS SDP_ID,
       b.NUMDOCUM   AS SDP_Num,
       b.DATEDOCUM  AS date_rassm,
       b.DATEADD    AS date_add,
       u.ID_JUDGE   AS JUDGE,
       b.PRPUB      AS STATE,
       b.DATEPUBLIC AS date_publ
from BSR.BSRP b
         INNER JOIN bsr.USERS_GROUP u ON b.ID_GROUP = u.ID_GROUP
         left JOIN bsr.RUB_DOCUM a on b.ID_DOCUM = a.ID_DOCUM
         left join bsr.RUB_DOCUM_EXCEPTION x on a.RUBRIKAT = x.VNCODE
where b.DATEPUBLIC IS NULL
  and x.VNCODE is null
  AND u.ID_JUDGE IS NOT NULL
  AND ((b.PRPUB != 2) OR (b.PRPUB is null))
  AND (extract(YEAR FROM to_date(b.DATEDOCUM)) = extract(YEAR FROM to_date(current_date)) OR
       extract(YEAR FROM to_date(b.DATEDOCUM)) = extract(YEAR FROM to_date(current_date)) - 1)


ИСпользование линка
select count(*)
from U1_case@IBASEDATA.US.ORACLE.COM A
where A.CASE_TYPE_ID = 50780000
  and A.VERDICT_DATE between to_date('2021-01-01', 'YYYY-MM-DD') and to_date('2021-12-31','YYYY-MM-DD')
  and A.judge_id = 8500013


Справка о работе судей через линк

SELECT username

/* 3. 1- за период */
     , (select count(*)
        from U1_case@IBASEDATA.US.ORACLE.COM A
        where A.CASE_TYPE_ID = 50780000
          and A.VERDICT_DATE between to_date(:p1, 'YYYY-MM-DD') and to_date(:p2, 'YYYY-MM-DD')
          and A.judge_id = c.groupcontentid)

/* 4. 2- за период */
     , (select count(*)
        from G1_case@IBASEDATA.US.ORACLE.COM A
        where A.CASE_TYPE_ID IN (50520001, 50520003, 50520002, 50520052)
          and A.RESULT_ID IN (50640004, 50640000, 50640001, 50640112, 50640002, 50640007, 50640003)
          and (A.DECISION_ID IN (50580000))
          and A.RESULT_DATE between to_date(:p1, 'YYYY-MM-DD') and to_date(:p2, 'YYYY-MM-DD')
          and A.judge_id = c.groupcontentid)

/* 5. 5- за период */
     , (select count(*) from ADM_case@IBASEDATA.US.ORACLE.COM A where A.DECREE_DATE between to_date(:p1, 'YYYY-MM-DD') and to_date(:p2, 'YYYY-MM-DD') and A.judge_id = c.groupcontentid)

/* 6. 10- за период */
     , (select count(*)
        from U1_case@IBASEDATA.US.ORACLE.COM A
        where A.CASE_TYPE_ID = 50780001
          and A.VERDICT_DATE between to_date(:p1, 'YYYY-MM-DD') and to_date(:p2, 'YYYY-MM-DD')
          and A.judge_id = c.groupcontentid)

/* 7. 11- за период */
     , (select count(*)
        from G1_case@IBASEDATA.US.ORACLE.COM A
        where A.CASE_TYPE_ID = 50520004
          and A.RESULT_ID IN
              (50640001, 50640200, 50640110, 50640109, 50640100, 50640104, 50640106, 50640103, 50640114, 50640111,
               50640107, 50640105)
          and A.RESULT_DATE between to_date(:p1, 'YYYY-MM-DD') and to_date(:p2, 'YYYY-MM-DD')
          and A.judge_id = c.groupcontentid)

/* 8. 12- из мирового за период */
     , (select count(*)
        from ADM1_case@IBASEDATA.US.ORACLE.COM A
        where A.COURT_I_LEVEL IN (70060000)
          and A.DECREE_DATE between to_date(:p1, 'YYYY-MM-DD') and to_date(:p2, 'YYYY-MM-DD')
          and A.judge_id = c.groupcontentid)

/* 9. 108 за период */
     , (select count(*)
        from M_case@IBASEDATA.US.ORACLE.COM A
        where A.M_SUB_TYPE IN (54010000)
          and A.VERDICT_DATE between to_date(:p1, 'YYYY-MM-DD') and to_date(:p2, 'YYYY-MM-DD')
          and A.judge_id = c.groupcontentid)

/* 10. 109 за период */
     , (select count(*)
        from M_case@IBASEDATA.US.ORACLE.COM A
        where A.M_SUB_TYPE IN (54010001)
          and A.VERDICT_DATE between to_date(:p1, 'YYYY-MM-DD') and to_date(:p2, 'YYYY-MM-DD')
          and A.judge_id = c.groupcontentid)

/* 11. 125 за период */
     , (select count(*)
        from M_case@IBASEDATA.US.ORACLE.COM A
        where A.M_SUB_TYPE IN (54010011, 54010029, 54010030, 54010031)
          and A.VERDICT_DATE between to_date(:p1, 'YYYY-MM-DD') and to_date(:p2, 'YYYY-MM-DD')
          and A.judge_id = c.groupcontentid)

/* 12. 165 за период */
     , (select count(*)
        from M_case@IBASEDATA.US.ORACLE.COM A
        where A.M_SUB_TYPE IN
              (54010036, 54010037, 54010035, 54010202, 54010203, 54010018, 54010806, 54010014, 54010009, 54010010,
               54010006, 54010008, 54010022, 54010003, 54010021, 54010041, 54010007, 54010005, 54010020, 54010026,
               54010004, 54010002, 54010035, 54010027, 54010028, 54010334, 54010023)
          and A.VERDICT_DATE between to_date(:p1, 'YYYY-MM-DD') and to_date(:p2, 'YYYY-MM-DD')
          and A.judge_id = c.groupcontentid)

/* 13. 397 за период */
     , (select count(*)
        from M_case@IBASEDATA.US.ORACLE.COM A
        where A.M_SUB_TYPE IN
              (54010360, 54010319, 54010805, 54010804, 54010803, 54010802, 54010899, 54010801, 54010357, 54010304,
               54010329, 54010300, 54010330, 54010374, 54010376, 54010377, 54010378, 54010380, 54010381, 54010382,
               54010025, 54010301, 54010331, 54010332, 54010303, 54010333, 54010335, 54010340, 54010307, 54010308,
               54010311, 54010312, 54010362, 54010702, 54010361, 54010317, 54010318, 54010350, 54010320, 54010351,
               54010321, 54010352, 54010353, 54010323, 54010354, 54010324, 54010355, 54010356, 54010327, 54010365,
               54010366, 54010367, 54010368, 54010369, 54010370)
          and A.VERDICT_DATE between to_date(:p1, 'YYYY-MM-DD') and to_date(:p2, 'YYYY-MM-DD')
          and A.judge_id = c.groupcontentid)

/* 14. 398 за период */
     , (select count(*)
        from M_case@IBASEDATA.US.ORACLE.COM A
        where A.M_SUB_TYPE IN (54010306, 54010309, 54010310, 54010313, 54010371)
          and A.VERDICT_DATE between to_date(:p1, 'YYYY-MM-DD') and to_date(:p2, 'YYYY-MM-DD')
          and A.judge_id = c.groupcontentid)

/* 16. Рассм матер по к-рым отказ в прин без движ за период*/
/* Гр - не рассм., посл. событие - без движения, а так же рассм., но результ. - отказ в принятии, а так же М - рассм., результ. - отказ в принятии */
     , ((select count(*)
         from G1_case@IBASEDATA.US.ORACLE.COM A
         where ((A.judge_id = c.groupcontentid) and (A.RESULT_ID = 50640005 and A.RESULT_DATE between to_date(:p1, 'YYYY-MM-DD') and to_date(:p2, 'YYYY-MM-DD')) OR
                (A.RESULT_DATE IS NULL AND A.SYS_EVENT_RESULT_ID = 50550202))))


/* 17. 12- из гос. органов за период */
     , (select count(*)
        from ADM1_case@IBASEDATA.US.ORACLE.COM A
        where A.COURT_I_LEVEL IN (70060002)
          and A.DECREE_DATE between to_date(:p1, 'YYYY-MM-DD') and to_date(:p2, 'YYYY-MM-DD')
          and A.judge_id = c.groupcontentid)

FROM groupcontent@IBASEDATA.US.ORACLE.COM C

WHERE exists(select * from g1_case@IBASEDATA.US.ORACLE.COM a where A.RESULT_DATE between to_date(:p1, 'YYYY-MM-DD') and to_date(:p2, 'YYYY-MM-DD') and a.judge_id = c.groupcontentid)
   or exists(select * from u1_case@IBASEDATA.US.ORACLE.COM a where A.VERDICT_DATE between to_date(:p1, 'YYYY-MM-DD') and to_date(:p2, 'YYYY-MM-DD') and a.judge_id = c.groupcontentid)

order by 1


Полный список рассмотренных, опубликованных, запрещенных
/* Уг дела - Приговоры */
SELECT DISTINCT A.ID AS ID,
                A.FULL_NUMBER AS FULL_NUMBER,
                A.VERDICT_DATE AS VERDICT_DATE,
                A.VALIDITY_DATE AS VALIDITY_DATE,
                A.VALIDITY_DATE + INTERVAL '30' DAY AS DATE_UNTILL,
                b.DATEPUBLIC AS DATE_PUBLIC,
                trunc(b.DATEPUBLIC - A.VALIDITY_DATE, 0) AS PUBL_DAYS,
                b.PRPUB AS STATUS,
                COALESCE(b.P_ANNOT, e.PRICH) AS PRICH
FROM U1_CASE@IBASEDATA.US.ORACLE.COM A
         left join bsr.BSRP b on a.ID = b.ID_AGORA
         left join bsr.RUB_DOCUM r on b.ID_DOCUM = r.ID_DOCUM
         left join bsr.RUB_DOCUM_EXCEPTION e on r.RUBRIKAT = e.VNCODE
WHERE A.VERDICT_ID IN (50910000)
  AND A.CASE_TYPE_ID IN (50780000)
  AND (extract(YEAR FROM to_date(A.VERDICT_DATE)) = extract(YEAR FROM to_date(current_date)) OR
       extract(YEAR FROM to_date(A.VERDICT_DATE)) = extract(YEAR FROM to_date(current_date)) - 1)
  AND A.JUDGE_ID = :JUDGE

UNION ALL

/* Уг. дела - постановления, без приговоров */
SELECT DISTINCT A.ID AS ID,
                A.FULL_NUMBER AS FULL_NUMBER,
                A.VERDICT_DATE AS VERDICT_DATE,
                A.VERDICT_DATE AS VALIDITY_DATE,
                A.VERDICT_DATE + INTERVAL '30' DAY AS DATE_UNTILL,
                b.DATEPUBLIC AS DATE_PUBLIC,
                trunc(b.DATEPUBLIC - A.VERDICT_DATE, 0) AS PUBL_DAYS,
                b.PRPUB AS STATUS,
                COALESCE(b.P_ANNOT, e.PRICH) AS PRICH
FROM U1_CASE@IBASEDATA.US.ORACLE.COM A
         left join bsr.BSRP b on a.ID = b.ID_AGORA
         left join bsr.RUB_DOCUM r on b.ID_DOCUM = r.ID_DOCUM
         left join bsr.RUB_DOCUM_EXCEPTION e on r.RUBRIKAT = e.VNCODE
WHERE
      ((A.VERDICT_ID IN (50910100,50910003,50910002, 50910004)) OR (A.VERDICT_ID IN (50910001)
  AND A.VERDICT_ID2 IN
      (50900007,51240002,50900001,51240025,50900000,51240001,51240000,51240015,51240022,51240019,51240017,50900018,51240006,51240009,51240003)))
  AND (A.CASE_TYPE_ID IN (50780000)
  AND (extract(YEAR FROM to_date(A.VERDICT_DATE)) = extract(YEAR FROM to_date(current_date)) OR
       extract(YEAR FROM to_date(A.VERDICT_DATE)) = extract(YEAR FROM to_date(current_date)) - 1)
  AND A.JUDGE_ID = :JUDGE)

UNION ALL

/* Уг дела АП. инст. */
SELECT DISTINCT A.ID AS ID,
                A.FULL_NUMBER AS FULL_NUMBER,
                A.VERDICT_DATE AS VERDICT_DATE,
                A.VERDICT_DATE AS VALIDITY_DATE,
                A.VERDICT_DATE + INTERVAL '30' DAY AS DATE_UNTILL,
                b.DATEPUBLIC AS DATE_PUBLIC,
                trunc(b.DATEPUBLIC - A.VERDICT_DATE, 0) AS PUBL_DAYS,
                b.PRPUB AS STATUS,
                COALESCE(b.P_ANNOT, e.PRICH) AS PRICH
FROM U1_case@IBASEDATA.US.ORACLE.COM A
         left join bsr.BSRP b on a.ID = b.ID_AGORA
         left join bsr.RUB_DOCUM r on b.ID_DOCUM = r.ID_DOCUM
         left join bsr.RUB_DOCUM_EXCEPTION e on r.RUBRIKAT = e.VNCODE
where A.CASE_TYPE_ID = 50780001
  AND A.VERDICT_ID IN (50910100)
  and (extract(YEAR FROM to_date(A.VERDICT_DATE)) = extract(YEAR FROM to_date(current_date)) OR
       extract(YEAR FROM to_date(A.VERDICT_DATE)) = extract(YEAR FROM to_date(current_date)) - 1)
  AND A.JUDGE_ID = :JUDGE

UNION ALL

SELECT DISTINCT A.ID AS ID,
                A.FULL_NUMBER AS FULL_NUMBER,
                A.RESULT_DATE AS VERDICT_DATE,
                A.RESULT_DATE AS VALIDITY_DATE,
                A.RESULT_DATE + INTERVAL '30' DAY AS DATE_UNTILL,
                b.DATEPUBLIC AS DATE_PUBLIC,
                trunc(b.DATEPUBLIC - A.RESULT_DATE, 0) AS PUBL_DAYS,
                b.PRPUB AS STATUS,
                COALESCE(b.P_ANNOT, e.PRICH) AS PRICH
FROM G1_CASE@IBASEDATA.US.ORACLE.COM A
         left join bsr.BSRP b on a.ID = b.ID_AGORA
         left join bsr.RUB_DOCUM r on b.ID_DOCUM = r.ID_DOCUM
         left join bsr.RUB_DOCUM_EXCEPTION e on r.RUBRIKAT = e.VNCODE
WHERE (A.CASE_TYPE_ID IN (50520001, 50520003, 50520002, 50520052) AND
       A.RESULT_ID IN (50640004, 50640000, 50640001, 50640112, 50640002, 50640007, 50640003) AND
       A.DECISION_ID IN (50580000) OR
       A.CASE_TYPE_ID = 50520004 AND
       A.RESULT_ID IN
       (50640001, 50640200, 50640110, 50640109, 50640100, 50640104, 50640106, 50640103, 50640114, 50640111, 50640107,
        50640105))
  AND (extract(YEAR FROM to_date(A.RESULT_DATE)) = extract(YEAR FROM to_date(current_date)) OR
       extract(YEAR FROM to_date(A.RESULT_DATE)) = extract(YEAR FROM to_date(current_date)) - 1)
  AND A.JUDGE_ID = :JUDGE

UNION ALL

SELECT A.ID AS ID,
       A.CASE_NUMBER AS FULL_NUMBER,
       A.DECREE_DATE AS VERDICT_DATE,
       A.DECREE_DATE AS VALIDITY_DATE,
       A.DECREE_DATE + INTERVAL '30' DAY AS DATE_UNTILL,
       b.DATEPUBLIC AS DATE_PUBLIC,
       trunc(b.DATEPUBLIC - A.DECREE_DATE, 0) AS PUBL_DAYS,
       b.PRPUB AS STATUS,
       COALESCE(b.P_ANNOT, e.PRICH) AS PRICH
FROM ADM_CASE@IBASEDATA.US.ORACLE.COM A
         left join bsr.BSRP b on a.ID = b.ID_AGORA
         left join bsr.RUB_DOCUM r on b.ID_DOCUM = r.ID_DOCUM
         left join bsr.RUB_DOCUM_EXCEPTION e on r.RUBRIKAT = e.VNCODE
WHERE (extract(YEAR FROM to_date(A.DECREE_DATE)) = extract(YEAR FROM to_date(current_date)) OR
       extract(YEAR FROM to_date(A.DECREE_DATE)) = extract(YEAR FROM to_date(current_date)) - 1)
  AND A.JUDGE_ID = :JUDGE

UNION ALL

SELECT A.ID AS ID,
       A.CASE_NUMBER AS FULL_NUMBER,
       A.DECREE_DATE AS VERDICT_DATE,
       A.DECREE_DATE AS VALIDITY_DATE,
       A.DECREE_DATE + INTERVAL '30' DAY AS DATE_UNTILL,
       b.DATEPUBLIC AS DATE_PUBLIC,
       trunc(b.DATEPUBLIC - A.DECREE_DATE, 0) AS PUBL_DAYS,
       b.PRPUB AS STATUS,
       COALESCE(b.P_ANNOT, e.PRICH) AS PRICH
FROM ADM1_CASE@IBASEDATA.US.ORACLE.COM A
         left join bsr.BSRP b on a.ID = b.ID_AGORA
         left join bsr.RUB_DOCUM r on b.ID_DOCUM = r.ID_DOCUM
         left join bsr.RUB_DOCUM_EXCEPTION e on r.RUBRIKAT = e.VNCODE
WHERE A.COURT_I_LEVEL IN (70060000, 70060002)
  AND (extract(YEAR FROM to_date(A.DECREE_DATE)) = extract(YEAR FROM to_date(current_date)) OR
       extract(YEAR FROM to_date(A.DECREE_DATE)) = extract(YEAR FROM to_date(current_date)) - 1)
  AND A.JUDGE_ID = :JUDGE


/* Список неопубликованных */
/* Уг дела - Приговоры */
SELECT DISTINCT A.ID                                     AS ID,
                A.FULL_NUMBER                            AS FULL_NUMBER,
                A.VERDICT_DATE                           AS VERDICT_DATE,
                A.VALIDITY_DATE                          AS VALIDITY_DATE,
                A.VALIDITY_DATE + INTERVAL '30' DAY      AS DATE_UNTILL,
                (CASE when b.ID_DOCUM is null then 'Не загружен в БСР' else 'Загружен в БСР, не опубликован' END) AS STAT
FROM U1_CASE@IBASEDATA.US.ORACLE.COM A
         left join bsr.BSRP b on a.ID = b.ID_AGORA
         left join bsr.RUB_DOCUM r on b.ID_DOCUM = r.ID_DOCUM
         left join bsr.RUB_DOCUM_EXCEPTION e on r.RUBRIKAT = e.VNCODE
WHERE A.VERDICT_ID IN (50910000)
  AND A.CASE_TYPE_ID IN (50780000)
  AND (extract(YEAR FROM to_date(A.VERDICT_DATE)) = extract(YEAR FROM to_date(current_date)) OR
       extract(YEAR FROM to_date(A.VERDICT_DATE)) = extract(YEAR FROM to_date(current_date)) - 1)
  AND A.JUDGE_ID = :JUDGE
AND b.DATEPUBLIC is null
    AND ((e.PRICH is null) AND (b.P_ANNOT is null))


UNION ALL

/* Уг. дела - постановления, без приговоров */
SELECT DISTINCT A.ID                                    AS ID,
                A.FULL_NUMBER                           AS FULL_NUMBER,
                A.VERDICT_DATE                          AS VERDICT_DATE,
                A.VERDICT_DATE                          AS VALIDITY_DATE,
                A.VERDICT_DATE + INTERVAL '30' DAY      AS DATE_UNTILL,
                (CASE when b.ID_DOCUM is null then 'Не загружен в БСР' else 'Загружен в БСР, не опубликован' END) AS STAT
FROM U1_CASE@IBASEDATA.US.ORACLE.COM A
         left join bsr.BSRP b on a.ID = b.ID_AGORA
         left join bsr.RUB_DOCUM r on b.ID_DOCUM = r.ID_DOCUM
         left join bsr.RUB_DOCUM_EXCEPTION e on r.RUBRIKAT = e.VNCODE
WHERE ((A.VERDICT_ID IN (50910100, 50910003, 50910002, 50910004)) OR (A.VERDICT_ID IN (50910001)
    AND A.VERDICT_ID2 IN
        (50900007, 51240002, 50900001, 51240025, 50900000, 51240001, 51240000, 51240015, 51240022, 51240019, 51240017,
         50900018, 51240006, 51240009, 51240003)))
  AND (A.CASE_TYPE_ID IN (50780000)
    AND (extract(YEAR FROM to_date(A.VERDICT_DATE)) = extract(YEAR FROM to_date(current_date)) OR
         extract(YEAR FROM to_date(A.VERDICT_DATE)) = extract(YEAR FROM to_date(current_date)) - 1)
    AND A.JUDGE_ID = :JUDGE)
  AND b.DATEPUBLIC is null
  AND ((e.PRICH is null) AND (b.P_ANNOT is null))

UNION ALL

/* Уг дела АП. инст. */
SELECT DISTINCT A.ID                                    AS ID,
                A.FULL_NUMBER                           AS FULL_NUMBER,
                A.VERDICT_DATE                          AS VERDICT_DATE,
                A.VERDICT_DATE                          AS VALIDITY_DATE,
                A.VERDICT_DATE + INTERVAL '30' DAY      AS DATE_UNTILL,
                (CASE when b.ID_DOCUM is null then 'Не загружен в БСР' else 'Загружен в БСР, не опубликован' END) AS STAT
FROM U1_case@IBASEDATA.US.ORACLE.COM A
         left join bsr.BSRP b on a.ID = b.ID_AGORA
         left join bsr.RUB_DOCUM r on b.ID_DOCUM = r.ID_DOCUM
         left join bsr.RUB_DOCUM_EXCEPTION e on r.RUBRIKAT = e.VNCODE
where A.CASE_TYPE_ID = 50780001
  AND A.VERDICT_ID IN (50910100)
  and (extract(YEAR FROM to_date(A.VERDICT_DATE)) = extract(YEAR FROM to_date(current_date)) OR
       extract(YEAR FROM to_date(A.VERDICT_DATE)) = extract(YEAR FROM to_date(current_date)) - 1)
  AND A.JUDGE_ID = :JUDGE
  AND b.DATEPUBLIC is null
  AND ((e.PRICH is null) AND (b.P_ANNOT is null))

UNION ALL

SELECT DISTINCT A.ID                                   AS ID,
                A.FULL_NUMBER                          AS FULL_NUMBER,
                A.RESULT_DATE                          AS VERDICT_DATE,
                A.RESULT_DATE                          AS VALIDITY_DATE,
                A.RESULT_DATE + INTERVAL '30' DAY      AS DATE_UNTILL,
                (CASE when b.ID_DOCUM is null then 'Не загружен в БСР' else 'Загружен в БСР, не опубликован' END) AS STAT
FROM G1_CASE@IBASEDATA.US.ORACLE.COM A
         left join bsr.BSRP b on a.ID = b.ID_AGORA
         left join bsr.RUB_DOCUM r on b.ID_DOCUM = r.ID_DOCUM
         left join bsr.RUB_DOCUM_EXCEPTION e on r.RUBRIKAT = e.VNCODE
WHERE (A.CASE_TYPE_ID IN (50520001, 50520003, 50520002, 50520052) AND
       A.RESULT_ID IN (50640004, 50640000, 50640001, 50640112, 50640002, 50640007, 50640003) AND
       A.DECISION_ID IN (50580000) OR
       A.CASE_TYPE_ID = 50520004 AND
       A.RESULT_ID IN
       (50640001, 50640200, 50640110, 50640109, 50640100, 50640104, 50640106, 50640103, 50640114, 50640111, 50640107,
        50640105))
  AND (extract(YEAR FROM to_date(A.RESULT_DATE)) = extract(YEAR FROM to_date(current_date)) OR
       extract(YEAR FROM to_date(A.RESULT_DATE)) = extract(YEAR FROM to_date(current_date)) - 1)
  AND A.JUDGE_ID = :JUDGE
  AND b.DATEPUBLIC is null
  AND ((e.PRICH is null) AND (b.P_ANNOT is null))

UNION ALL

SELECT A.ID                                   AS ID,
       A.CASE_NUMBER                          AS FULL_NUMBER,
       A.DECREE_DATE                          AS VERDICT_DATE,
       A.DECREE_DATE                          AS VALIDITY_DATE,
       A.DECREE_DATE + INTERVAL '30' DAY      AS DATE_UNTILL,
       (CASE when b.ID_DOCUM is null then 'Не загружен в БСР' else 'Загружен в БСР, не опубликован' END) AS STAT
FROM ADM_CASE@IBASEDATA.US.ORACLE.COM A
         left join bsr.BSRP b on a.ID = b.ID_AGORA
         left join bsr.RUB_DOCUM r on b.ID_DOCUM = r.ID_DOCUM
         left join bsr.RUB_DOCUM_EXCEPTION e on r.RUBRIKAT = e.VNCODE
WHERE (extract(YEAR FROM to_date(A.DECREE_DATE)) = extract(YEAR FROM to_date(current_date)) OR
       extract(YEAR FROM to_date(A.DECREE_DATE)) = extract(YEAR FROM to_date(current_date)) - 1)
  AND A.JUDGE_ID = :JUDGE
  AND b.DATEPUBLIC is null
  AND ((e.PRICH is null) AND (b.P_ANNOT is null))

UNION ALL

SELECT A.ID                                   AS ID,
       A.CASE_NUMBER                          AS FULL_NUMBER,
       A.DECREE_DATE                          AS VERDICT_DATE,
       A.DECREE_DATE                          AS VALIDITY_DATE,
       A.DECREE_DATE + INTERVAL '30' DAY      AS DATE_UNTILL,
       (CASE when b.ID_DOCUM is null then 'Не загружен в БСР' else 'Загружен в БСР, не опубликован' END) AS STAT
FROM ADM1_CASE@IBASEDATA.US.ORACLE.COM A
         left join bsr.BSRP b on a.ID = b.ID_AGORA
         left join bsr.RUB_DOCUM r on b.ID_DOCUM = r.ID_DOCUM
         left join bsr.RUB_DOCUM_EXCEPTION e on r.RUBRIKAT = e.VNCODE
WHERE A.COURT_I_LEVEL IN (70060000, 70060002)
  AND (extract(YEAR FROM to_date(A.DECREE_DATE)) = extract(YEAR FROM to_date(current_date)) OR
       extract(YEAR FROM to_date(A.DECREE_DATE)) = extract(YEAR FROM to_date(current_date)) - 1)
  AND A.JUDGE_ID = :JUDGE
  AND b.DATEPUBLIC is null
  AND ((e.PRICH is null) AND (b.P_ANNOT is null))




/ * Список неопубликованных с фио */

/* Список неопубликованных */
/* Уг дела - Приговоры */
SELECT DISTINCT A.ID                                                 AS ID,
                max(A.FULL_NUMBER)                                   AS FULL_NUMBER,
                max(A1.NAME)                                         AS FIELD_FIO,
                max(A.VERDICT_DATE)                                  AS VERDICT_DATE,
                max(A.VALIDITY_DATE)                                 AS VALIDITY_DATE,
                max(A.VALIDITY_DATE + INTERVAL '30' DAY)             AS DATE_UNTILL,
                max((CASE
                         when b.ID_DOCUM is null then 'Не загружен в БСР'
                         else 'Загружен в БСР, не опубликован' END)) AS STAT
FROM U1_CASE@IBASEDATA.US.ORACLE.COM A
         left join bsr.BSRP b on a.ID = b.ID_AGORA
         left join bsr.RUB_DOCUM r on b.ID_DOCUM = r.ID_DOCUM
         left join bsr.RUB_DOCUM_EXCEPTION e on r.RUBRIKAT = e.VNCODE
         LEFT OUTER JOIN U1_DEFENDANT@IBASEDATA.US.ORACLE.COM A1 ON A.ID = A1.CASE_ID
WHERE A.VERDICT_ID IN (50910000)
  AND A.CASE_TYPE_ID IN (50780000)
  AND (extract(YEAR FROM to_date(A.VERDICT_DATE)) = extract(YEAR FROM to_date(current_date)) OR
       extract(YEAR FROM to_date(A.VERDICT_DATE)) = extract(YEAR FROM to_date(current_date)) - 1)
  AND A.JUDGE_ID = :JUDGE
  AND b.DATEPUBLIC is null
  AND ((e.PRICH is null) AND (b.P_ANNOT is null))
group by A.ID

UNION ALL

/* Уг. дела - постановления, без приговоров */
SELECT DISTINCT A.ID                                                 AS ID,
                max(A.FULL_NUMBER)                                   AS FULL_NUMBER,
                max(A1.NAME)                                         AS FIELD_FIO,
                max(A.VERDICT_DATE)                                  AS VERDICT_DATE,
                max(A.VERDICT_DATE)                                  AS VALIDITY_DATE,
                max(A.VERDICT_DATE + INTERVAL '30' DAY)              AS DATE_UNTILL,
                max((CASE
                         when b.ID_DOCUM is null then 'Не загружен в БСР'
                         else 'Загружен в БСР, не опубликован' END)) AS STAT
FROM U1_CASE@IBASEDATA.US.ORACLE.COM A
         left join bsr.BSRP b on a.ID = b.ID_AGORA
         left join bsr.RUB_DOCUM r on b.ID_DOCUM = r.ID_DOCUM
         left join bsr.RUB_DOCUM_EXCEPTION e on r.RUBRIKAT = e.VNCODE
         LEFT OUTER JOIN U1_DEFENDANT@IBASEDATA.US.ORACLE.COM A1 ON A.ID = A1.CASE_ID

WHERE ((A.VERDICT_ID IN (50910100, 50910003, 50910002, 50910004)) OR (A.VERDICT_ID IN (50910001)
    AND A.VERDICT_ID2 IN
        (50900007, 51240002, 50900001, 51240025, 50900000, 51240001, 51240000, 51240015, 51240022, 51240019, 51240017,
         50900018, 51240006, 51240009, 51240003)))
  AND (A.CASE_TYPE_ID IN (50780000)
    AND (extract(YEAR FROM to_date(A.VERDICT_DATE)) = extract(YEAR FROM to_date(current_date)) OR
         extract(YEAR FROM to_date(A.VERDICT_DATE)) = extract(YEAR FROM to_date(current_date)) - 1)
    AND A.JUDGE_ID = :JUDGE)
  AND b.DATEPUBLIC is null
  AND ((e.PRICH is null) AND (b.P_ANNOT is null))
group by A.ID

UNION ALL

/* Уг дела АП. инст. */
SELECT DISTINCT A.ID                                                 AS ID,
                max(A.FULL_NUMBER)                                   AS FULL_NUMBER,
                max(A1.NAME)                                         AS FIELD_FIO,
                max(A.VERDICT_DATE)                                  AS VERDICT_DATE,
                max(A.VERDICT_DATE)                                  AS VALIDITY_DATE,
                max(A.VERDICT_DATE + INTERVAL '30' DAY)              AS DATE_UNTILL,
                max((CASE
                         when b.ID_DOCUM is null then 'Не загружен в БСР'
                         else 'Загружен в БСР, не опубликован' END)) AS STAT
FROM U1_case@IBASEDATA.US.ORACLE.COM A
         left join bsr.BSRP b on a.ID = b.ID_AGORA
         left join bsr.RUB_DOCUM r on b.ID_DOCUM = r.ID_DOCUM
         left join bsr.RUB_DOCUM_EXCEPTION e on r.RUBRIKAT = e.VNCODE
         LEFT OUTER JOIN U1_DEFENDANT@IBASEDATA.US.ORACLE.COM A1 ON A.ID = A1.CASE_ID
where A.CASE_TYPE_ID = 50780001
  AND A.VERDICT_ID IN (50910100)
  and (extract(YEAR FROM to_date(A.VERDICT_DATE)) = extract(YEAR FROM to_date(current_date)) OR
       extract(YEAR FROM to_date(A.VERDICT_DATE)) = extract(YEAR FROM to_date(current_date)) - 1)
  AND A.JUDGE_ID = :JUDGE
  AND b.DATEPUBLIC is null
  AND ((e.PRICH is null) AND (b.P_ANNOT is null))
group by A.ID

UNION ALL

SELECT DISTINCT A.ID                                                 AS ID,
                max(A.FULL_NUMBER)                                   AS FULL_NUMBER,
                max(A1.NAME)                                         as FIELD_FIO,
                max(A.RESULT_DATE)                                   AS VERDICT_DATE,
                max(A.RESULT_DATE)                                   AS VALIDITY_DATE,
                max(A.RESULT_DATE + INTERVAL '30' DAY)               AS DATE_UNTILL,
                max((CASE
                         when b.ID_DOCUM is null then 'Не загружен в БСР'
                         else 'Загружен в БСР, не опубликован' END)) AS STAT
FROM G1_CASE@IBASEDATA.US.ORACLE.COM A
         left join bsr.BSRP b on a.ID = b.ID_AGORA
         left join bsr.RUB_DOCUM r on b.ID_DOCUM = r.ID_DOCUM
         left join bsr.RUB_DOCUM_EXCEPTION e on r.RUBRIKAT = e.VNCODE
         LEFT OUTER JOIN G1_PARTS@IBASEDATA.US.ORACLE.COM A1 ON A.ID = A1.CASE_ID
WHERE (A.CASE_TYPE_ID IN (50520001, 50520003, 50520002, 50520052) AND
       A.RESULT_ID IN (50640004, 50640000, 50640001, 50640112, 50640002, 50640007, 50640003) AND
       A.DECISION_ID IN (50580000) OR
       A.CASE_TYPE_ID = 50520004 AND
       A.RESULT_ID IN
       (50640001, 50640200, 50640110, 50640109, 50640100, 50640104, 50640106, 50640103, 50640114, 50640111, 50640107,
        50640105))
  AND (extract(YEAR FROM to_date(A.RESULT_DATE)) = extract(YEAR FROM to_date(current_date)) OR
       extract(YEAR FROM to_date(A.RESULT_DATE)) = extract(YEAR FROM to_date(current_date)) - 1)
  AND A.JUDGE_ID = :JUDGE
  AND b.DATEPUBLIC is null
  AND ((e.PRICH is null) AND (b.P_ANNOT is null))
group by A.ID

UNION ALL

SELECT A.ID                                                                                                   AS ID,
       max(A.CASE_NUMBER)                                                                                     AS FULL_NUMBER,
       max(A2.NAME)                                                                                           AS FIELD_FIO,
       max(A.DECREE_DATE)                                                                                     AS VERDICT_DATE,
       max(A.DECREE_DATE)                                                                                     AS VALIDITY_DATE,
       max(A.DECREE_DATE + INTERVAL '30' DAY)                                                                 AS DATE_UNTILL,
       max((CASE when b.ID_DOCUM is null then 'Не загружен в БСР' else 'Загружен в БСР, не опубликован' END)) AS STAT
FROM ADM_CASE@IBASEDATA.US.ORACLE.COM A
         left join bsr.BSRP b on a.ID = b.ID_AGORA
         left join bsr.RUB_DOCUM r on b.ID_DOCUM = r.ID_DOCUM
         left join bsr.RUB_DOCUM_EXCEPTION e on r.RUBRIKAT = e.VNCODE
         LEFT OUTER JOIN ADM_PARTS@IBASEDATA.US.ORACLE.COM A2 ON A.ID = A2.CASE_ID
WHERE (extract(YEAR FROM to_date(A.DECREE_DATE)) = extract(YEAR FROM to_date(current_date)) OR
       extract(YEAR FROM to_date(A.DECREE_DATE)) = extract(YEAR FROM to_date(current_date)) - 1)
  AND A.JUDGE_ID = :JUDGE
  AND b.DATEPUBLIC is null
  AND ((e.PRICH is null) AND (b.P_ANNOT is null))
  AND b.PRPUB <> 1
group by A.ID

UNION ALL

SELECT A.ID                                                                                                   AS ID,
       max(A.CASE_NUMBER)                                                                                     AS FULL_NUMBER,
       max(A.DEFENDANT_NAME)                                                                                  AS FIELD_FIO,
       max(A.DECREE_DATE)                                                                                     AS VERDICT_DATE,
       max(A.DECREE_DATE)                                                                                     AS VALIDITY_DATE,
       max(A.DECREE_DATE + INTERVAL '30' DAY)                                                                 AS DATE_UNTILL,
       max((CASE when b.ID_DOCUM is null then 'Не загружен в БСР' else 'Загружен в БСР, не опубликован' END)) AS STAT
FROM ADM1_CASE@IBASEDATA.US.ORACLE.COM A
         left join bsr.BSRP b on a.ID = b.ID_AGORA
         left join bsr.RUB_DOCUM r on b.ID_DOCUM = r.ID_DOCUM
         left join bsr.RUB_DOCUM_EXCEPTION e on r.RUBRIKAT = e.VNCODE
WHERE A.COURT_I_LEVEL IN (70060000, 70060002)
  AND (extract(YEAR FROM to_date(A.DECREE_DATE)) = extract(YEAR FROM to_date(current_date)) OR
       extract(YEAR FROM to_date(A.DECREE_DATE)) = extract(YEAR FROM to_date(current_date)) - 1)
  AND A.JUDGE_ID = :JUDGE
  AND b.DATEPUBLIC is null
  AND ((e.PRICH is null) AND (b.P_ANNOT is null))
group by A.ID




/* ID судей в Агоре */
8500014 - Асеев
9300076 - Басурова
9300120 - Вайцещук
8500009 - Дроздов
8500016 - Кривчук
9000032 - Мельничук
9300113 - Мильченко
9300132 - Павлова
8500013 - Сабанцев
9300127 - Соловьев
8500015 - Тарасова
8500018 - Штукина

/* Рассмотренные сверх срока по id судьи */
SELECT A.CASE_ID,
       A.CASE_NUMBER,
       A.PLAINTIFF_INFO || ', ' || A.DEFENDANT_INFO,
       A.ENTRY_DATE
FROM G1_OVER_PERIOD_CASE2(cast(cast(Extract(year FROM cast('NOW' as date)) as varchar(10)) || '-01-01' as DATE), cast('NOW' as timestamp)) A
  LEFT OUTER JOIN GROUPCONTENT OA2
ON A.JUDGE_NAME = OA2.USERNAME
WHERE
    OA2.GROUPCONTENTID = :judge
